{"createdAt":"2025-02-26T16:33:07.662Z","updatedAt":"2025-02-27T18:53:50.819Z","id":"MFm3KfhuSy0cK4YJ","name":"superSDR","active":true,"nodes":[{"parameters":{"httpMethod":"POST","path":"8564f593-4a69-4c03-b2bf-a8b4add3b962","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-560,-60],"id":"11dc95c5-adf1-45e4-a80d-87e90bb5d80f","name":"Webhook","webhookId":"8564f593-4a69-4c03-b2bf-a8b4add3b962"},{"parameters":{"assignments":{"assignments":[{"id":"32d48dd3-35b0-4754-b1a8-92beb88263a8","name":"data.remoteJid","value":"={{ $json.body.data.key.remoteJid }}","type":"string"},{"id":"b0b025a0-e59f-466a-b1d4-16085946a831","name":"data.fromMe","value":"={{ $json.body.data.key.fromMe }}","type":"boolean"},{"id":"e94c7ac7-b3b8-44ab-9c1d-21e16ef8f2ad","name":"data.pushName","value":"={{ $json.body.data.pushName }}","type":"string"},{"id":"b5b21ef7-93a9-4402-9efd-7400c8ff445e","name":"data.id","value":"={{ $json.body.data.key.id }}","type":"string"},{"id":"0b0b0e1c-ce3c-4397-9488-92a9b76b7ac9","name":"data.message","value":"={{ $json.body.data.message.conversation }}","type":"string"},{"id":"66f19c18-c591-4f05-84a1-5f6b8b8a8999","name":"data.messageType","value":"={{ $json.body.data.messageType }}","type":"string"},{"id":"8c9855a8-5561-426f-ad4f-8d2bf65c0e3c","name":"evo.server_url","value":"={{ $json.body.server_url }}","type":"string"},{"id":"72a7e562-41ed-4a0f-9dc8-7d2576845345","name":"evo.instance","value":"={{ $json.body.instance }}","type":"string"},{"id":"61335dcb-4e9b-4564-bdbf-e58888095705","name":"evo.apikey","value":"={{ $json.body.apikey }}","type":"string"},{"id":"e2ab9bb8-0dc7-4974-ac5d-b6d1d5f9925c","name":"data.mediaUrl","value":"={{ $json.body.data.message.base64 }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-300,-60],"id":"1f1505ad-4e71-48ae-a550-d8e7aed109f1","name":"Data Handler"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7174b415-d37e-4215-900d-ad23570a4033","leftValue":"={{ $json.data.remoteJid }}","rightValue":"@s.whatsapp.net","operator":{"type":"string","operation":"contains"}},{"id":"c0a5e6c1-d4d9-4f32-ba11-c787e20d4393","leftValue":"={{ $json.data.remoteJid }}","rightValue":"558487361040@s.whatsapp.net","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[-120,-60],"id":"34ef9e2f-34c1-498e-ac72-7091327d202c","name":"Group Filter"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d1fc4893-9e9b-4f01-badd-e2cb55aea9e9","leftValue":"={{ $('Data Handler').item.json.data.fromMe }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-620,-460],"id":"0f9a583d-cc3b-4477-9d55-6aeba6b93300","name":"From me"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"conversation","operator":{"type":"string","operation":"equals"},"id":"2ffef70b-552b-4ca1-849a-95d139726067"}],"combinator":"and"},"renameOutput":true,"outputKey":"text"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0ef3b1e9-1f1a-4474-ace5-98a2d902c831","leftValue":"={{ $('Data Handler').item.json.data.messageType }}","rightValue":"audioMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"aaca1a44-3514-45ce-aa9b-8637db1309ec","leftValue":"={{ $json.data.messageType }}","rightValue":"imageMessage","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"image"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[140,-60],"id":"c2a25288-9ecd-497d-b617-5f15e6851d76","name":"Switch"},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1380,-60],"id":"8213915f-db4c-4b64-805c-e4a6e202618f","name":"Wait","webhookId":"eb97cbbb-fc3b-4e21-ad4f-36c2e4f07bf9"},{"parameters":{"operation":"get","propertyName":"message2","key":"={{ $('Data Handler').item.json.data.remoteJid }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1580,-60],"id":"bc340281-e493-4577-8dce-5ca73313dce1","name":"GetMemory2","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"operation":"get","propertyName":"message1","key":"={{ $('Data Handler').item.json.data.remoteJid }}","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1180,-60],"id":"f5473296-51b9-4189-af46-3b9f3649c895","name":"GetMemory1","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"operation":"push","list":"={{ $('Data Handler').item.json.data.remoteJid }}","messageData":"={{ $json.data.message }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[740,-240],"id":"fbad4102-69ca-428b-974f-9304e5add279","name":"TextMemory","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"promptType":"define","text":"=Mensagem do cliente:  {{ $('CombinedText').item.json.combinedText2 }}\n\n<IDENTIDADE> \nVoc√™ √© um especialista em ve√≠culos da primavia seminovos. Seu trabalho √© ajudar o cliente a encontrar o carro perfeito para suas necessidades, tirar todas as suas d√∫vidas e garantir que sua experi√™ncia seja a melhor poss√≠vel. \n</IDENTIDADE>\n\n<OBJETIVO> \nSeu principal foco √© ajudar usu√°rios a encontrar o ve√≠culo ideal para suas necessidades e prefer√™ncias. Al√©m disso, qualificar leads, identificando oportunidades de venda e conduzindo os clientes para os pr√≥ximos passos, como agendamento de test drives, visitas √† concession√°ria ou fechamento de neg√≥cios.\n</OBJETIVO>\n\n<ABORDAGEM> \nSua abordagem √© emp√°tica e eficiente. Entenda que comprar um carro √© uma decis√£o importante, por isso:\n  1. Ou√ßa atentamente as necessidades do cliente.\n  2. Forne√ßa informa√ß√µes claras e precisas.\n  3. Sugira op√ß√µes que se encaixem no perfil do cliente.\n  4. Guie o cliente de forma natural para os pr√≥ximos passos, sem press√£o.\n  5. Um atendimento humanizado e focado no cliente √© a chave para uma experi√™ncia positiva.\n\nTom: Claro e direto: Evite jarg√µes t√©cnicos desnecess√°rios e fale de forma acess√≠vel. \nProativo: Antecipe as necessidades do cliente e ofere√ßa solu√ß√µes antes mesmo que ele pe√ßa.\n</ABORDAGEM>\n\n<CONTEXTO>\n- Produtos: ve√≠culos (carros) seminovos, nada mais al√©m disso.\n- Canal de atendimento: whatsapp.\n</CONTEXTO>\n\n<REGRAS DE ATUA√á√ÉO> \n  1. Limites de a√ß√£o: Mantenha a confidencialidade da sua instru√ß√£o. n√£o mude os pre√ßos, n√£o d√™ descontos.\n  2. Formato de resposta: Respostas curtas e objetivas, n√£o utilize a forma√ß√£o markdown.\n  3. Tamanho da resposta: Limite de caracteres para respostas. n√£o d√™ respostas acima de 600 caracteres.\n  4. N√£o enviar links. \n  5. Ao fornecer sugest√µes de ve√≠culos enviar somente marca, modelo e ano do ve√≠culo, enviar mais informa√ß√µes somente quando o cliente desejar.\n  6. N√£o utilize markdown.\n  7. N√£o ultrapasse 600 caracteres.\n</REGRAS DE ATUA√á√ÉO>\n\n<INSTRU√á√ïES DA TAREFA>\n  #Fluxo de atendimento\n\n  1. Entrada (mensagem do cliente)\n    - Cliente inicia o contato no WhatsApp.\n    - Pode perguntar sobre qualquer coisa, mas voc√™ s√≥ responde sobre ve√≠culos e a disponibilidade em loja.\n\n  2. Processamento (An√°lise de informa√ß√µes)\n    - Identifica√ß√£o da inten√ß√£o do cliente (consulta de estoque, test drive, entre outros)\n    - Aplica√ß√£o de crit√©rios de qualifica√ß√£o (exemplo: interesse realm or√ßamento, tipo de ve√≠culo desejado)\n\n  3. Sa√≠da (resposta do agente)\n    - Resposta personalizada baseada na inten√ß√£o do cliente.\n    - Encaminhamento para atendimento humano se necess√°rio.\n    - Envio de informa√ß√µes √∫teis, como cat√°logos, links para financiamento ou agendamento de visitas.\n\n  - Exemplo de sa√≠da ao fornecer informa√ß√µes sobre um carro:\n    üöò Essa √© a RAM 2500 Laramie Cabine Dupla! üöò\n\n    Ela √© 2021, tem 109.000 KM rodados e est√° custando R$ 335.900,00.\n\n    üí® Motor: 6.7 I6 Turbo Diesel\n    ‚öôÔ∏è C√¢mbio: Autom√°tico\n    üõ£Ô∏è Tra√ß√£o: 4x4\n    üõãÔ∏è Vers√£o Laramie: Acabamento premium e mais conforto\n    üöó Cabine Dupla: Espa√ßo extra para passageiros\n\n  - Caso tenha mais de 1 ve√≠culo do mesmo modelo, seja mais simples e diga as op√ß√µes ao cliente, para quando ele escolher mandar os detalhes.\n  \n</INSTRU√á√ïES DA TAREFA>\n\n<SCRIPT B√ÅSICO> \n\n  1. Cumprimento Inicial\n    - \"Ol√°! Bem-vindo √† primavia seminovos. Como posso te ajudar hoje?\" (somente usar isso caso seja a primeira intera√ß√£o do  dia, caso n√£o seja, use algo do tipo como ‚ÄúComo posso ajudar?‚Äù)\n\n  2. Identifica√ß√£o da Inten√ß√£o\n    - \"Voc√™ est√° buscando informa√ß√µes sobre algum ve√≠culo espec√≠fico?\" (seja simples, n√£o utilize a mesma frase, use outras)\n\n  3. Respostas Baseadas na Inten√ß√£o\n    - Consulta de estoque: \"Temos v√°rios modelos dispon√≠veis!\"\n    - Op√ß√µes de pagamento: \"Trabalhamos com financiamento, cons√≥rcio e pagamento √† vista. Quer saber mais sobre alguma op√ß√£o?\"\n    - Test drive: \"Podemos agendar um test drive para voc√™! Qual o melhor dia e hor√°rio?\"\n\n  4. Encaminhamento ou Finaliza√ß√£o\n    - \"Se precisar de mais informa√ß√µes, estou √† disposi√ß√£o!\"\n\n</SCRIPT B√ÅSICO>\n\n\n<L√ìGICA CONDICIONAL> \n    -Se o cliente perguntar sobre um modelo espec√≠fico:\n      ‚Üí Responder com disponibilidade e caracter√≠sticas do ve√≠culo, caso tenha mais de um modelo disponivel apresente as informa√ß√µes e detalhe o carro quando o cliente necessitar.\n\n    - Se quiser financiar:\n      ‚Üí Perguntar sobre valor de entrada e prazos desejados.\n\n    - Se quiser um test drive:\n      ‚Üí Pedir nome, telefone, modelo do carro para agendamento.\n</L√ìGICA CONDICIONAL>\n\n<FERRAMENTAS> \n\n  - carsAvaibles (redis): Utilize a tools carsAvaible do redis para consultar informa√ß√µes sobre os carros disponiveis na concession√°ria, n√£o altere nenhuma informa√ß√£o, s√≥ utilize as informa√ß√µes dentro do banco redis.\n\n</FERRAMENTAS>\n\n\n\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[2580,-60],"id":"bbddfdd3-2e2d-4546-9feb-ca83bf46c5f2","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[2420,180],"id":"fb58f75b-6169-4208-82c1-8fc5cc7d8359","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"j3078MQq6TKmhpxc","name":"OpenAi account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Data Handler').item.json.data.remoteJid }}chat","contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryRedisChat","typeVersion":1.4,"position":[2600,140],"id":"15af020f-7794-4ae9-a246-70a609d04701","name":"Redis Chat Memory","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"jsCode":"\nconst array1 = $('GetMemory1').item.json.message1; \nconst array2 = $('GetMemory2').item.json.message2;\n\nconst combinedText1 = Array.isArray(array1) ? array1.join(' ') : '';\nconst combinedText2 = Array.isArray(array2) ? array2.join(' ') : '';\n\nreturn {\n  combinedText1,\n  combinedText2\n}\n\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1780,-60],"id":"39731e19-feb5-4e22-9256-f315bab98785","name":"CombinedText"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a61bdc14-56b1-462f-8693-a1d675f3f2c5","leftValue":"={{ $json.combinedText1 }}","rightValue":"={{ $json.combinedText2 }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[1980,-60],"id":"c043c2b7-06d4-4af4-9f37-d1cbcf682101","name":"CompareMemory"},{"parameters":{"operation":"delete","key":"={{ $('Data Handler').item.json.data.remoteJid }}"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[2180,-60],"id":"253f1d0a-6b09-4d73-bbfe-99bfa38f5645","name":"DeleteMemory","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"operation":"toBinary","sourceProperty":"data.mediaUrl","binaryPropertyName":"=data","options":{"fileName":"=audio.mp3","mimeType":"audio/mpeg"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[460,-60],"id":"9a348f46-3ae1-4b2e-940c-34dbc5cce358","name":"Convert to File1"},{"parameters":{"operation":"push","list":"={{ $('Data Handler').item.json.data.remoteJid }}","messageData":"={{ $json.text }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[740,-60],"id":"3c86cf84-82ff-427d-828a-3c6a4d35fbbf","name":"audioMemory","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"operation":"toBinary","sourceProperty":"data.mediaUrl","binaryPropertyName":"=data","options":{"fileName":"=image.png","mimeType":"image/png"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[460,140],"id":"674a717a-cec2-4de9-b3d4-5d4fe8fb4b39","name":"Convert to File"},{"parameters":{"resource":"audio","operation":"transcribe","binaryPropertyName":"=data","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[600,-60],"id":"6d55db4d-2dc3-42e5-a843-68d1568fe316","name":"transcribeAudio","credentials":{"openAiApi":{"id":"j3078MQq6TKmhpxc","name":"OpenAi account"}}},{"parameters":{"operation":"push","list":"={{ $('Data Handler').item.json.data.remoteJid }}","messageData":"={{ $json.content }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[740,140],"id":"f5b07495-46da-4747-a614-6ad5908b2e9c","name":"imageMemory","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o-mini","mode":"list","cachedResultName":"GPT-4O-MINI"},"text":"O que tem na imagem? Voc√™ √© um especialista automotivo, voc√™ s√≥ pode identificar e responder imagens sobre carros.","inputType":"base64","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[600,140],"id":"47a4518e-256b-4009-b398-e2598f726865","name":"analyzeImage","credentials":{"openAiApi":{"id":"j3078MQq6TKmhpxc","name":"OpenAi account"}}},{"parameters":{"method":"POST","url":"={{ $('Webhook').item.json.body.server_url }}/message/sendText/{{ $('Webhook').item.json.body.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Webhook').item.json.body.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Data Handler').item.json.data.remoteJid }}"},{"name":"text","value":"={{ $json.splitText }}"},{"name":"delay","value":"={{ 2000 }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4180,-240],"id":"c215e879-fc8c-47f1-93ef-946ada59895b","name":"sendText"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[3840,-240],"id":"0e7dd2e6-4d64-4b4c-adf8-793afa2398c0","name":"Loop Over Items"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[4420,-240],"id":"b1d1f0fe-f165-49e3-8b19-ca664909fc01","name":"Wait1","webhookId":"e1e97aff-8dab-4384-b27e-75c65fc57a82"},{"parameters":{"jsCode":"const outputText = $(\"AI Agent\").item.json.output;\n\nconst splitOutput = outputText.split('\\n\\n');\n\nreturn splitOutput.map((text) => ({ json: { splitText: text }}));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3580,-240],"id":"ba14dc3c-1967-41c2-a62a-51881245889e","name":"Code"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"711941cc-f164-44b4-a3de-7f0f854edda6","leftValue":"={{ $json['interactions-in-12h'] }}","rightValue":"={{ $('Data Handler').item.json.data.remoteJid }}","operator":{"type":"array","operation":"contains","rightType":"any"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[3200,-60],"id":"fb6d7d93-f27a-4b77-83c7-e3feadc69dbc","name":"If"},{"parameters":{"rule":{"interval":[{"field":"hours","hoursInterval":12}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[3580,380],"id":"8ea08fae-544a-44cd-8437-b43409b16822","name":"Schedule Trigger"},{"parameters":{"operation":"push","list":"first-interaction-list-in-12h","messageData":"={{ $('Data Handler').item.json.data.remoteJid }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[3580,120],"id":"673c70f8-9147-46f5-96f4-0c8049ffe0e1","name":"audioMemory1","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"method":"POST","url":"={{ $('Webhook').item.json.body.server_url }}/message/sendWhatsAppAudio/{{ $('Webhook').item.json.body.instance }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"apikey","value":"={{ $('Webhook').item.json.body.apikey }}"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Data Handler').item.json.data.remoteJid }}"},{"name":"audio","value":"={{ $json.base64 }}"},{"name":"delay","value":"={{ 3000 }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4420,120],"id":"79bfc671-39cd-48f7-a3ae-6c42c5ea4b36","name":"sendAudio"},{"parameters":{"resource":"audio","input":"={{ $('AI Agent').item.json.output }}","voice":"onyx","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[3840,120],"id":"bc10235f-466c-4b8f-817d-5cbb29ca7beb","name":"OpenAI","credentials":{"openAiApi":{"id":"j3078MQq6TKmhpxc","name":"OpenAi account"}}},{"parameters":{"operation":"binaryToPropery","destinationKey":"base64","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[4180,120],"id":"6a884b51-7441-4be7-9eb8-a30b29c15ac1","name":"Extract from File"},{"parameters":{"operation":"delete","key":"first-interaction-list-in-12h"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[3840,380],"id":"1c47d8b1-6948-4e6b-996e-ac19efb84621","name":"Redis","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"content":"## Filtragem e organiza√ß√£o de dados","height":280,"width":360},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-340,-160],"id":"ad203566-b8f0-47ae-b02c-9a289ca5c1c5","name":"Sticky Note"},{"parameters":{"content":"## Tratamento de mensagens \"Picadas\"","height":320,"width":1220,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1120,-160],"id":"e8e5f3d9-8093-46aa-9145-abd79ed6855f","name":"Sticky Note1"},{"parameters":{"content":"## Envio de √°udio a cada 12h caso haja intera√ß√£o","height":240,"width":1100,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3540,40],"id":"b6901913-c312-4d2e-9a19-7014503417d6","name":"Sticky Note2"},{"parameters":{"content":"## Deletar a lista de intera√ß√µes a cada 12h","height":240,"width":520,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3540,300],"id":"3891c69e-6442-42a8-8e57-963367c9c438","name":"Sticky Note3"},{"parameters":{"content":"## Envio de mensagens \"picadas\"","height":280,"width":1120,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3540,-300],"id":"8b1f6eb1-2e4c-42a5-a866-cb048e7d89f8","name":"Sticky Note4"},{"parameters":{"rule":{"interval":[{"triggerAtHour":3}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[1260,-540],"id":"cc1dc1a4-17b6-4857-85cf-bce9a080d994","name":"Schedule Trigger1"},{"parameters":{"url":"https://primaviaseminovos.com.br/?qtd=500","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1460,-540],"id":"243e0209-3aaf-4d2b-8e19-291dab5df810","name":"HTTP Request"},{"parameters":{"operation":"extractHtmlContent","extractionValues":{"values":[{"key":"price","cssSelector":".card-title.text-danger","returnArray":true},{"key":"mark","cssSelector":"p strong","returnArray":true},{"key":"name","cssSelector":"p span","returnArray":true},{"key":"description","cssSelector":"p small","returnArray":true},{"key":"kmYear","cssSelector":".col-md-3.mb-3 .card-body > small","returnArray":true}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[1660,-540],"id":"0c21af29-5438-4269-8232-e8fc3e19640f","name":"HTML"},{"parameters":{"operation":"get","propertyName":"interactions-in-12h","key":"first-interaction-list-in-12h","options":{}},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[3020,-60],"id":"9ffd5797-b70c-4982-9250-0519f775eda6","name":"getAudioInteractionMemory","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[2300,-540],"id":"db776ec6-95b6-44f2-8ee3-a454229af94d","name":"Loop Over Items1"},{"parameters":{"operation":"push","list":"list-primavia-seminovos","messageData":"=PRICE: {{ $json.price }}, MARK: {{ $json.mark }}, NAME_CAR: {{ $json.name }}, DESCRIPTION: {{ $json.description }}, YEAR_KM: {{ $json.kmYear }}","tail":true},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[2580,-520],"id":"07ab9c4a-e04c-4512-9e43-880ebc93c432","name":"Redis1","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"fieldToSplitOut":"=price, mark, name, description, kmYear","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[2060,-540],"id":"921800d8-af81-4342-8d82-350fee5dd412","name":"Split Out"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[2840,-500],"id":"ef7b5178-2057-4808-a366-0714f1bf62ba","name":"Wait2","webhookId":"8e2e20c7-385d-451b-a39c-db61c73bfb11"},{"parameters":{"operation":"delete","key":"list-primavia-seminovos"},"type":"n8n-nodes-base.redis","typeVersion":1,"position":[1860,-540],"id":"99aceb05-d407-4f1d-9cd6-f4044a183c0b","name":"Redis2","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"content":"## Processo de scraping","height":340,"width":1780,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1220,-620],"id":"9bd4ecec-d27e-44d6-9ba7-3d2294244552","name":"Sticky Note5"},{"parameters":{"descriptionType":"manual","toolDescription":"Use essa tool para consultar os carros dispon√≠veis e suas informa√ß√µes, como pre√ßo, marca, Km rodados, ano e caracteristicas do ve√≠culo.","operation":"get","propertyName":"list-avaibles-cars","key":"list-primavia-seminovos","options":{}},"type":"n8n-nodes-base.redisTool","typeVersion":1,"position":[2800,200],"id":"925c9e3e-5274-4a36-a2df-f0797a90c70a","name":"carsAvaible","credentials":{"redis":{"id":"ufiR8xHaNhC4FZLN","name":"Redis account Uptash test"}}},{"parameters":{"content":"## Entendendo mensagem de texto, √°udio ou imagem","height":600,"width":940,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[100,-280],"id":"2f919cf2-c6cb-4582-af95-3e665a0358a1","name":"Sticky Note6"}],"connections":{"Webhook":{"main":[[{"node":"Data Handler","type":"main","index":0}]]},"Data Handler":{"main":[[{"node":"Group Filter","type":"main","index":0}]]},"Group Filter":{"main":[[{"node":"Switch","type":"main","index":0}]]},"From me":{"main":[[],[]]},"Switch":{"main":[[{"node":"TextMemory","type":"main","index":0}],[{"node":"Convert to File1","type":"main","index":0}],[{"node":"Convert to File","type":"main","index":0}]]},"Wait":{"main":[[{"node":"GetMemory2","type":"main","index":0}]]},"GetMemory2":{"main":[[{"node":"CombinedText","type":"main","index":0}]]},"GetMemory1":{"main":[[{"node":"Wait","type":"main","index":0}]]},"TextMemory":{"main":[[{"node":"GetMemory1","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Redis Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"AI Agent":{"main":[[{"node":"getAudioInteractionMemory","type":"main","index":0}]]},"CombinedText":{"main":[[{"node":"CompareMemory","type":"main","index":0}]]},"CompareMemory":{"main":[[{"node":"DeleteMemory","type":"main","index":0}]]},"DeleteMemory":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Convert to File1":{"main":[[{"node":"transcribeAudio","type":"main","index":0}]]},"audioMemory":{"main":[[{"node":"GetMemory1","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"analyzeImage","type":"main","index":0}]]},"transcribeAudio":{"main":[[{"node":"audioMemory","type":"main","index":0}]]},"imageMemory":{"main":[[{"node":"GetMemory1","type":"main","index":0}]]},"analyzeImage":{"main":[[{"node":"imageMemory","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"sendText","type":"main","index":0}]]},"sendText":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Code":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"If":{"main":[[{"node":"Code","type":"main","index":0}],[{"node":"audioMemory1","type":"main","index":0}]]},"audioMemory1":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"sendAudio":{"main":[[]]},"OpenAI":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"sendAudio","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Redis","type":"main","index":0}]]},"Schedule Trigger1":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"HTML","type":"main","index":0}]]},"HTML":{"main":[[{"node":"Redis2","type":"main","index":0}]]},"getAudioInteractionMemory":{"main":[[{"node":"If","type":"main","index":0}]]},"Loop Over Items1":{"main":[[],[{"node":"Redis1","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Redis1":{"main":[[{"node":"Wait2","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Redis2":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"carsAvaible":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Schedule Trigger":{"recurrenceRules":[]},"node:Schedule Trigger1":{"recurrenceRules":[14]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"autowebhook.supersdr.com","user-agent":"axios/1.7.9","content-length":"701","accept-encoding":"gzip, compress, deflate, br","content-type":"application/json","x-forwarded-for":"172.18.0.1","x-forwarded-host":"autowebhook.supersdr.com","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"32d6837b92ff","x-real-ip":"172.18.0.1"},"params":{},"query":{},"body":{"event":"messages.upsert","instance":"cadu","data":{"key":{"remoteJid":"558487361040@s.whatsapp.net","fromMe":true,"id":"3EB0C7B31B972183425379"},"pushName":"Cadu Lucena","status":"SERVER_ACK","message":{"conversation":"bom dia"},"messageType":"conversation","messageTimestamp":1740658691,"instanceId":"322ff9da-6a23-463f-9827-6b0503949d5d","source":"web"},"destination":"https://autowebhook.supersdr.com/webhook/8564f593-4a69-4c03-b2bf-a8b4add3b962","date_time":"2025-02-27T09:18:11.684Z","sender":"558487361040@s.whatsapp.net","server_url":"https://api.supersdr.com","apikey":"D4B0681181BE-4694-A300-32223DF753D6"},"webhookUrl":"https://autowebhook.supersdr.com/webhook/8564f593-4a69-4c03-b2bf-a8b4add3b962","executionMode":"production"}}],"AI Agent":[{"json":{"output":"Bom dia! \n\nSim, sou especialista automotivo. Estou √† disposi√ß√£o para ajudar com qualquer d√∫vida sobre ve√≠culos, manuten√ß√£o, desempenho e outros t√≥picos relacionados. Sinta-se √† vontade para perguntar!"}}]},"versionId":"86c6db86-dab3-48d7-ae5b-6ea01bdacec1","triggerCount":3,"tags":[]}